const apiUrl = "https://script.google.com/macros/library/d/1IyvwxGakxupetRtYfxdeeBuaDlIt0oeO0pVM4Srru6CpjpJCMGLwP3Jl/5"; // Thay YOUR_WEB_APP_URL bằng URL Web App đã triển khai

function addOvertime() {
  const employeeId = selectedEmployee?.id || "";
  const date = document.getElementById("overtime-date").value;
  const hours = document.getElementById("overtime-hours").value;

  if (!employeeId || !date || !hours) {
    alert("Vui lòng nhập đầy đủ thông tin.");
    return;
  }

  const data = { employeeId, date, hours };

  fetch(apiUrl, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data),
  })
    .then((response) => response.text())
    .then((result) => {
      if (result === "Success") {
        alert("Lưu thành công!");
        fetchOvertimeHistory();
      } else {
        alert("Có lỗi xảy ra.");
      }
    })
    .catch((error) => console.error("Error:", error));
}

function fetchOvertimeHistory() {
  fetch(apiUrl)
    .then((response) => response.json())
    .then((rows) => {
      const historyDiv = document.getElementById("overtime-history");
      historyDiv.innerHTML = `
        <table border="1" style="width: 100%; text-align: left; border-collapse: collapse;">
          <tr>
            <th>Mã NV</th>
            <th>Ngày</th>
            <th>Giờ tăng ca</th>
          </tr>
          ${rows
            .map(
              (row) =>
                `<tr><td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td></tr>`
            )
            .join("")}
        </table>`;
    })
    .catch((error) => console.error("Error:", error));
}

// Hiển thị lịch sử tăng ca khi tải trang
document.addEventListener("DOMContentLoaded", fetchOvertimeHistory);
